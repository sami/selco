---
import SelcoLayout from '../layouts/SelcoLayout.astro';
import SelcoSidebar from '../components/selco/SelcoSidebar.astro';

const BASE_URL = import.meta.env.BASE_URL;
const base = BASE_URL.endsWith('/') ? BASE_URL : `${BASE_URL}/`;

const breadcrumbs = [
  { label: 'Home' }
];

const title = "Trade Projects Calculator";
const description = "Project calculators for tradespeople. Calculate all materials for tiling, masonry, and concrete projects in one guided flow. Accurate quantities with wastage included.";

const handyCalculators = [
  {
    title: 'Unit Converter',
    description: 'Convert between metric and imperial units for length, area, volume, and weight. Useful when product data sheets and site measurements use different systems.',
    href: '#' // To be updated when page exists
  }
];

const projectCalculators = [
  {
    title: 'Tiling Project',
    description: 'Estimate tiles, adhesive, grout, spacers, and self-levelling compound for any floor or wall area. Enter your dimensions once and get quantities for every material.',
    href: '#'
  },
  {
    title: 'Masonry Project',
    description: 'Calculate bricks or blocks, sand, cement, and wall ties for single-skin or cavity walls. Deduct windows and doors automatically.',
    href: '#'
  },
  {
    title: 'Concrete & Groundworks Project',
    description: 'Work out cement, sand, aggregate, and hardcore sub-base quantities for slabs and foundations. Covers both the concrete and the sub-base underneath.',
    href: '#'
  }
];

const faqs = [
  {
    question: 'How accurate are the calculations?',
    answer: 'All calculations use industry-standard formulas and manufacturer coverage rates. Results include a configurable wastage percentage to account for cuts and breakage. They are calculations based on standard formulas, not exact quantities. Always round up when ordering.'
  },
  {
    question: 'What is wastage and why does it matter?',
    answer: 'Wastage accounts for offcuts, breakage, and pattern matching. A typical allowance is 10% for tiles and 5% for bricks. Skipping wastage often means a return trip to the merchant.'
  },
  {
    question: 'Do I need to create an account?',
    answer: 'No. All calculators run in your browser with no sign-up, no login, and no data stored.'
  },
  {
    question: 'What units are supported?',
    answer: 'Both metric (metres, millimetres, kilograms) and imperial (feet, inches, yards). The Unit Converter handles conversions between them.'
  },
  {
    question: 'What is a project calculator?',
    answer: 'A project calculator chains every material for a specific job into one guided flow. For example, the Tiling Project covers tiles, adhesive, grout, spacers, and self-levelling compound. You enter your dimensions once and get quantities for all of them.'
  }
];

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: faqs.map(faq => ({
    '@type': 'Question',
    name: faq.question,
    acceptedAnswer: {
      '@type': 'Answer',
      text: faq.answer
    }
  }))
};

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Trade Projects Calculator',
  description: description,
  url: 'https://www.tradeprojectscalculator.com',
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: 'https://www.tradeprojectscalculator.com?q={search_term_string}'
    },
    query_input: 'required name=search_term_string'
  }
};
---

<SelcoLayout
  title={title}
  description={description}
  showSidebar={true}
  breadcrumbs={breadcrumbs}
  pageTitle="Trade Projects Calculator"
>
  <SelcoSidebar />

  <main class="w-full">
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
    
    <div class="space-y-12 pb-12">
      {/* Intro Section */}
      <section class="space-y-6 max-w-3xl">
        <p class="text-lg text-muted-foreground leading-relaxed">
          Estimate every material for your project in one go. Select a project type, enter your dimensions, and get a full materials list with wastage included.
        </p>
        <p class="text-lg text-muted-foreground leading-relaxed">
          Each project calculator walks you through every material step by step. No more switching between separate tools for tiles, adhesive, grout, and spacers. One flow covers everything.
        </p>
        <p class="text-lg text-muted-foreground leading-relaxed">
          Built for tradespeople who need quick, accurate answers on site.
        </p>
      </section>

      {/* Search Bar */}
      <section class="max-w-lg">
        <label for="search-calculators" class="sr-only">Search calculators and projects</label>
        <div class="relative">
          <input
            id="search-calculators"
            type="text"
            placeholder="Search calculators and projects..."
            class="w-full px-4 py-3 border border-border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-blue/40"
          >
        </div>
      </section>

      {/* Handy Calculators Section */}
      <section class="space-y-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-bold text-surface-foreground mb-2">Handy Calculators</h2>
          <p class="text-muted-foreground text-base">Quick utility tools for everyday conversions and calculations.</p>
        </div>
        
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3" data-section="handy-calculators">
          {handyCalculators.map(calc => (
            <a
              href={calc.href}
              data-name={calc.title.toLowerCase()}
              class="group rounded-lg border border-border bg-surface p-5 card-shadow hover:border-brand-blue/40 hover:-translate-y-0.5 hover:shadow-md transition-all duration-200"
            >
              <h3 class="font-semibold text-surface-foreground group-hover:text-brand-blue transition-colors">{calc.title}</h3>
              <p class="mt-2 text-sm text-muted-foreground leading-relaxed">{calc.description}</p>
            </a>
          ))}
        </div>
        
        <p class="text-sm text-muted-foreground italic">
          More handy calculators coming soon: Coverage Calculator, Sheet Material Cutting Planner.
        </p>

        {/* No results state */}
        <div id="no-handy-results" class="hidden text-center py-8">
          <p class="text-muted-foreground">No matching handy calculators found.</p>
        </div>
      </section>

      {/* Project Calculators Section */}
      <section class="space-y-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-bold text-surface-foreground mb-2">Project Calculators</h2>
          <p class="text-muted-foreground text-base">The main product. Each project calculator chains every related material into a single guided flow.</p>
        </div>
        
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3" data-section="project-calculators">
          {projectCalculators.map(project => (
            <a
              href={project.href}
              data-name={project.title.toLowerCase()}
              class="group rounded-lg border border-border bg-surface p-5 card-shadow hover:border-brand-blue/40 hover:-translate-y-0.5 hover:shadow-md transition-all duration-200"
            >
              <h3 class="font-semibold text-surface-foreground group-hover:text-brand-blue transition-colors">{project.title}</h3>
              <p class="mt-2 text-sm text-muted-foreground leading-relaxed">{project.description}</p>
            </a>
          ))}
        </div>

        {/* No results state */}
        <div id="no-project-results" class="hidden text-center py-8">
          <p class="text-muted-foreground">No matching project calculators found.</p>
        </div>
      </section>

      {/* How It Works Section */}
      <section class="space-y-6 max-w-3xl">
        <h2 class="text-2xl md:text-3xl font-bold text-surface-foreground">How It Works</h2>
        
        <ol class="space-y-4 text-muted-foreground">
          <li class="flex gap-4">
            <span class="font-bold text-brand-blue flex-shrink-0">1.</span>
            <div>
              <strong class="text-surface-foreground block">Pick a project</strong>
              <p>Choose Tiling, Masonry, or Concrete & Groundworks.</p>
            </div>
          </li>
          <li class="flex gap-4">
            <span class="font-bold text-brand-blue flex-shrink-0">2.</span>
            <div>
              <strong class="text-surface-foreground block">Enter your measurements</strong>
              <p>Input dimensions like length, width, and depth. Each step shows placeholder values to guide you.</p>
            </div>
          </li>
          <li class="flex gap-4">
            <span class="font-bold text-brand-blue flex-shrink-0">3.</span>
            <div>
              <strong class="text-surface-foreground block">Step through each material</strong>
              <p>The wizard moves you through every material in the project. Skip optional steps if you need to.</p>
            </div>
          </li>
          <li class="flex gap-4">
            <span class="font-bold text-brand-blue flex-shrink-0">4.</span>
            <div>
              <strong class="text-surface-foreground block">Get your full materials list</strong>
              <p>A summary page shows every material and quantity, with wastage included. Ready for ordering.</p>
            </div>
          </li>
        </ol>
      </section>

      {/* FAQ Section */}
      <section class="space-y-6 max-w-3xl">
        <h2 class="text-2xl md:text-3xl font-bold text-surface-foreground">Frequently Asked Questions</h2>
        
        <div class="space-y-4">
          {faqs.map((faq, index) => (
            <details class="border border-border rounded-lg p-4 group">
              <summary class="cursor-pointer font-semibold text-surface-foreground hover:text-brand-blue transition-colors flex items-center gap-2">
                {faq.question}
                <span class="inline-block group-open:rotate-180 transition-transform">â–¼</span>
              </summary>
              <p class="mt-4 text-muted-foreground leading-relaxed">{faq.answer}</p>
            </details>
          ))}
        </div>
      </section>
    </div>

    <div class="content-footer" style="padding: 20px 24px; margin-top: 60px; border: 2px solid #004B8D; border-radius: 8px; background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%); font-size: 0.8rem; color: #004B8D; line-height: 1.6; box-shadow: 0 2px 8px rgba(0, 43, 128, 0.1); display: flex; gap: 20px; align-items: center; justify-content: space-between; flex-wrap: wrap;">
      <span class="content-footer-disclaimer" style="display: block; color: #00264d; font-weight: 700; font-size: 0.85rem; padding: 10px 12px; background-color: rgba(255, 205, 0, 0.15); border-left: 3px solid #FFCD00; border-radius: 4px; flex: 1; min-width: 200px;">Disclaimer: Calculations are estimates only. Always verify product coverage and site conditions before ordering.</span>
      <a href="https://madebysami.notion.site/2fe361401cd480fc9fcfdf4871d199b1?pvs=105" style="color: white; text-decoration: none; font-weight: 700; display: inline-block; padding: 8px 16px; border-radius: 6px; background-color: #004B8D; transition: all 0.3s ease; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; flex-shrink: 0;">Share feedback</a>
    </div>
  </main>
</SelcoLayout>

<script>
  // Client-side search functionality
  const searchInput = document.getElementById('search-calculators') as HTMLInputElement;
  const handySection = document.querySelector('[data-section="handy-calculators"]');
  const projectSection = document.querySelector('[data-section="project-calculators"]');
  const noHandyResults = document.getElementById('no-handy-results');
  const noProjectResults = document.getElementById('no-project-results');

  if (searchInput) {
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.toLowerCase().trim();

      // Filter handy calculators
      if (handySection) {
        const handyCards = handySection.querySelectorAll('a[data-name]');
        let handyVisible = 0;

        handyCards.forEach(card => {
          const name = (card as HTMLElement).dataset.name || '';
          const text = card.textContent?.toLowerCase() || '';
          const matches = !query || name.includes(query) || text.includes(query);
          (card as HTMLElement).style.display = matches ? '' : 'none';
          if (matches) handyVisible++;
        });

        if (noHandyResults) {
          noHandyResults.classList.toggle('hidden', handyVisible > 0);
        }
      }

      // Filter project calculators
      if (projectSection) {
        const projectCards = projectSection.querySelectorAll('a[data-name]');
        let projectVisible = 0;

        projectCards.forEach(card => {
          const name = (card as HTMLElement).dataset.name || '';
          const text = card.textContent?.toLowerCase() || '';
          const matches = !query || name.includes(query) || text.includes(query);
          (card as HTMLElement).style.display = matches ? '' : 'none';
          if (matches) projectVisible++;
        });

        if (noProjectResults) {
          noProjectResults.classList.toggle('hidden', projectVisible > 0);
        }
      }
    });
  }
</script>
