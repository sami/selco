---
import BaseLayout from '../layouts/BaseLayout.astro';

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Trade Materials Calculator",
  "url": Astro.url.href,
  "description": "Free trade tools to calculate material quantities for building projects. Accurate estimates for tiles, adhesive, grout, spacers, and more.",
  "applicationCategory": "BusinessApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "GBP"
  }
};

const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;

const calculators = [
  {
    title: "Tiles",
    href: "calculators/tiles/",
    desc: "Work out how many tiles you need for walls and floors.",
  },
  {
    title: "Adhesive",
    href: "calculators/adhesive/",
    desc: "Estimate adhesive coverage for your tile area.",
  },
  {
    title: "Grout",
    href: "calculators/grout/",
    desc: "Calculate the number of grout bags required.",
  },
  {
    title: "Spacers",
    href: "calculators/spacers/",
    desc: "Find out how many spacers to buy for your layout.",
  },
  {
    title: "Conversions",
    href: "calculators/conversions/",
    desc: "Convert between metric and imperial measurements.",
  },
  {
    title: "Masonry",
    href: "calculators/masonry/",
    desc: "Calculate bricks, blocks, mortar, and wall ties for any wall.",
  },
];
---

<BaseLayout
  title="Trade Materials Calculator | Building Materials Estimator"
  description="Work out exactly what you need for your next project. Free trade tools to calculate material quantities for building projects."
  jsonLd={jsonLd}
>
  <div class="space-y-12 pb-12">

    {/* Welcome Section */}
    <section class="pt-8 md:pt-12 space-y-6">
      <div class="space-y-2">
        <h1 class="text-2xl md:text-3xl font-bold text-surface-foreground tracking-tight">
          What are you working on today?
        </h1>
        <p class="text-muted-foreground text-base md:text-lg">
          Jump straight into a calculator, or search for what you need.
        </p>
      </div>

      {/* Search Input */}
      <div class="relative max-w-md">

        <label for="calculator-search" class="sr-only">Search calculators</label>
        <input
          type="text"
          placeholder="Search calculators..."
          class="w-full pl-4 pr-4 py-3 bg-surface border border-border rounded-[--radius-input] text-sm text-surface-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-brand-blue/30 focus:border-brand-blue/40 transition-all"
          id="calculator-search"
        />
      </div>
    </section>

    {/* Calculator Quick-Access Grid */}
    <section>
      <h2 class="sr-only">Calculators</h2>
      <div class="grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-5" id="calculator-grid">
        {calculators.map((calc) => (
          <a
            href={`${base}${calc.href}`}
            class="group flex flex-col p-5 md:p-6 bg-surface rounded-[--radius-card] border border-border card-shadow hover:border-brand-blue/40 hover:-translate-y-0.5 hover:shadow-md transition-all duration-200 focus-ring"
            data-name={calc.title.toLowerCase()}
          >
            <h3 class="font-bold text-surface-foreground group-hover:text-brand-blue transition-colors mb-1">
              {calc.title}
            </h3>
            <p class="text-sm text-muted-foreground leading-relaxed">
              {calc.desc}
            </p>
          </a>
        ))}
      </div>
    </section>

    {/* Tiling Project Spotlight */}
    <section>
      <a
        href={`${base}projects/tiling/`}
        class="group block rounded-[--radius-card] bg-gradient-to-br from-brand-blue to-blue-900 p-6 md:p-8 text-white overflow-hidden relative focus-ring"
      >
        <div class="flex flex-col md:flex-row items-start md:items-center gap-5 md:gap-8">
          <div class="flex-1 space-y-1">
            <h3 class="text-lg md:text-xl font-bold">Planning a tiling project?</h3>
            <p class="text-blue-200 text-sm md:text-base">
              Calculate tiles, adhesive, grout, and spacers in one go.
            </p>
          </div>
          <div class="shrink-0">
            <span class="inline-flex items-center px-5 py-2.5 bg-brand-yellow text-brand-blue font-bold text-sm rounded-[--radius-button] group-hover:scale-105 transition-transform duration-200 shadow-sm">
              Start project
            </span>
          </div>
        </div>
      </a>
    </section>

    {/* Quick Tip */}
    <section class="p-5 bg-surface rounded-[--radius-card] border border-border">
      <h3 class="font-semibold text-surface-foreground text-sm">Quick tip</h3>
      <p class="text-sm text-muted-foreground mt-0.5">
        Always add 10% extra to your tile quantity to account for cuts, breakages, and pattern matching.
      </p>
    </section>

  </div>

  {/* Client-side search filtering */}
  <script>
    const searchInput = document.getElementById('calculator-search') as HTMLInputElement;
    const grid = document.getElementById('calculator-grid');

    if (searchInput && grid) {
      searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase().trim();
        const cards = grid.querySelectorAll<HTMLAnchorElement>('a[data-name]');

        cards.forEach((card) => {
          const name = card.dataset.name ?? '';
          const desc = card.querySelector('p')?.textContent?.toLowerCase() ?? '';
          const matches = !query || name.includes(query) || desc.includes(query);
          card.style.display = matches ? '' : 'none';
        });
      });
    }
  </script>
</BaseLayout>
