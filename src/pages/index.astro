---
import BaseLayout from '../layouts/BaseLayout.astro';

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "SELCO Calculator",
  "url": Astro.url.href,
  "description": "Free trade tools to calculate material quantities for building projects. Accurate estimates for tiles, adhesive, grout, spacers, and more.",
  "applicationCategory": "BusinessApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "GBP"
  }
};

const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;

const calculators = [
  {
    title: "Tiles",
    href: "calculators/tiles/",
    desc: "Work out how many tiles you need for walls and floors.",
    iconPath: "M3 3h7v7H3zM14 3h7v7h-7zM3 14h7v7H3zM14 14h7v7h-7z",
  },
  {
    title: "Adhesive",
    href: "calculators/adhesive/",
    desc: "Estimate adhesive coverage for your tile area.",
    iconPath: "M12 2v6m0 0a3 3 0 1 0 0 6m0-6a3 3 0 1 1 0 6m0 0v4m-4 2h8",
  },
  {
    title: "Grout",
    href: "calculators/grout/",
    desc: "Calculate the number of grout bags required.",
    iconPath: "M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.582a.5.5 0 0 1 0 .963L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",
  },
  {
    title: "Spacers",
    href: "calculators/spacers/",
    desc: "Find out how many spacers to buy for your layout.",
    iconPath: "M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0zM14.5 12.5 2 25M7.5 4.5l12 12",
  },
  {
    title: "Conversions",
    href: "calculators/conversions/",
    desc: "Convert between metric and imperial measurements.",
    iconPath: "M8 3 4 7l4 4M4 7h16M16 21l4-4-4-4M20 17H4",
  },
];
---

<BaseLayout
  title="Trade Materials Calculator | Building Materials Estimator"
  description="Work out exactly what you need for your next project. Free trade tools to calculate material quantities for building projects."
  jsonLd={jsonLd}
>
  <div class="space-y-12 pb-12">

    {/* Welcome Section */}
    <section class="pt-8 md:pt-12 space-y-6">
      <div class="space-y-2">
        <h1 class="text-2xl md:text-3xl font-bold text-surface-foreground tracking-tight">
          What are you working on today?
        </h1>
        <p class="text-muted-foreground text-base md:text-lg">
          Jump straight into a calculator, or search for what you need.
        </p>
      </div>

      {/* Search Input */}
      <div class="relative max-w-md">
        <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none text-muted-foreground">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.3-4.3" />
          </svg>
        </div>
        <input
          type="text"
          placeholder="Search calculators..."
          class="w-full pl-11 pr-4 py-3 bg-surface border border-border rounded-[--radius-input] text-sm text-surface-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-brand-blue/30 focus:border-brand-blue/40 transition-all"
          id="calculator-search"
        />
      </div>
    </section>

    {/* Calculator Quick-Access Grid */}
    <section>
      <h2 class="sr-only">Calculators</h2>
      <div class="grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-5" id="calculator-grid">
        {calculators.map((calc) => (
          <a
            href={`${base}${calc.href}`}
            class="group flex flex-col p-5 md:p-6 bg-surface rounded-[--radius-card] border border-border card-shadow hover:border-brand-blue/40 hover:-translate-y-0.5 hover:shadow-md transition-all duration-200 focus-ring"
            data-name={calc.title.toLowerCase()}
          >
            <div class="w-10 h-10 md:w-11 md:h-11 rounded-xl bg-brand-blue/5 text-brand-blue flex items-center justify-center mb-4 group-hover:bg-brand-blue/10 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d={calc.iconPath} />
              </svg>
            </div>
            <h3 class="font-bold text-surface-foreground group-hover:text-brand-blue transition-colors mb-1">
              {calc.title}
            </h3>
            <p class="text-sm text-muted-foreground leading-relaxed">
              {calc.desc}
            </p>
          </a>
        ))}
      </div>
    </section>

    {/* Tiling Project Spotlight */}
    <section>
      <a
        href={`${base}calculators/tiles/`}
        class="group block rounded-[--radius-card] bg-gradient-to-br from-brand-blue to-blue-900 p-6 md:p-8 text-white overflow-hidden relative focus-ring"
      >
        <div class="flex flex-col md:flex-row items-start md:items-center gap-5 md:gap-8">
          <div class="w-12 h-12 rounded-xl bg-white/15 flex items-center justify-center shrink-0">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z" />
              <path d="m6.08 9.5-3.5 1.6a1 1 0 0 0 0 1.81l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9a1 1 0 0 0 0-1.83l-3.5-1.59" />
              <path d="m6.08 14.5-3.5 1.6a1 1 0 0 0 0 1.81l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9a1 1 0 0 0 0-1.83l-3.5-1.59" />
            </svg>
          </div>
          <div class="flex-1 space-y-1">
            <h3 class="text-lg md:text-xl font-bold">Planning a tiling project?</h3>
            <p class="text-blue-200 text-sm md:text-base">
              Calculate tiles, adhesive, grout, and spacers in one go.
            </p>
          </div>
          <div class="shrink-0">
            <span class="inline-flex items-center px-5 py-2.5 bg-brand-yellow text-brand-blue font-bold text-sm rounded-[--radius-button] group-hover:scale-105 transition-transform duration-200 shadow-sm">
              Start calculating
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="ml-2">
                <path d="M5 12h14" />
                <path d="m12 5 7 7-7 7" />
              </svg>
            </span>
          </div>
        </div>
      </a>
    </section>

    {/* Quick Tip */}
    <section class="flex items-start gap-4 p-5 bg-surface rounded-[--radius-card] border border-border">
      <div class="w-9 h-9 rounded-lg bg-brand-yellow/10 text-brand-yellow flex items-center justify-center shrink-0 mt-0.5">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5" />
          <path d="M9 18h6" />
          <path d="M10 22h4" />
        </svg>
      </div>
      <div>
        <h3 class="font-semibold text-surface-foreground text-sm">Quick tip</h3>
        <p class="text-sm text-muted-foreground mt-0.5">
          Always add 10% extra to your tile quantity to account for cuts, breakages, and pattern matching.
        </p>
      </div>
    </section>

  </div>

  {/* Client-side search filtering */}
  <script>
    const searchInput = document.getElementById('calculator-search') as HTMLInputElement;
    const grid = document.getElementById('calculator-grid');

    if (searchInput && grid) {
      searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase().trim();
        const cards = grid.querySelectorAll<HTMLAnchorElement>('a[data-name]');

        cards.forEach((card) => {
          const name = card.dataset.name ?? '';
          const desc = card.querySelector('p')?.textContent?.toLowerCase() ?? '';
          const matches = !query || name.includes(query) || desc.includes(query);
          card.style.display = matches ? '' : 'none';
        });
      });
    }
  </script>
</BaseLayout>
